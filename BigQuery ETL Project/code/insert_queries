-- Insert into the customer table from the staging table
INSERT INTO d607pa2-456203.ecommerce.customer (customer_id, name, email, phone, address)
SELECT DISTINCT
    customer.customer_id,
    customer.name,
    customer.email,
    customer.phone,
    customer.address
FROM
    d607pa2-456203.ecommerce.staging;

-- Insert into shopping_cart table from the staging table

INSERT INTO d607pa2-456203.ecommerce.shopping_cart (transaction_id, product_id, vendor, product_category, product_name, quantity, price)
SELECT
  staging.transaction_id,
  sc.product_id,
  sc.vendor,
  sc.product_category,
  sc.product_name,
  CAST(sc.quantity AS INT64),
  CAST(sc.price AS FLOAT64)
FROM
  d607pa2-456203.ecommerce.staging AS staging,
  UNNEST(staging.shopping_cart) AS sc;


-- Insert into the transaction table from the staging table
INSERT INTO d607pa2-456203.ecommerce.transaction (transaction_id, customer_id, transaction_date, shipping_method, total_amount)
SELECT
  transaction_id,
  customer.customer_id,
  CAST(transaction_date AS TIMESTAMP),
  shipping_method,
  CAST(total_amount AS FLOAT64)
FROM
  d607pa2-456203.ecommerce.staging;